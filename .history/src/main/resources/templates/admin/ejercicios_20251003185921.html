<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlowFit - Gestión de Ejercicios</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link th:href="@{/css/admin-dashboard.css}" rel="stylesheet">
  <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .exercise-management-header {
            background: linear-gradient(135deg, #374151, #1f2937);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 0 0 15px 15px;
            border-bottom: 3px solid #991b1b;
        }
        
        .stats-card {
            background: rgba(55, 65, 81, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        
        .exercise-card {
            background: rgba(55, 65, 81, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .exercise-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .exercise-image-container {
            width: 100%;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background-color: rgba(75, 85, 99, 0.2);
            overflow: hidden;
        }
        
        .exercise-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .search-filters-card {
            background: rgba(55, 65, 81, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .btn-create {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            border: none;
            color: white;
            box-shadow: 0 4px 15px rgba(153, 27, 27, 0.2);
        }
        
        .btn-create:hover {
            background: linear-gradient(135deg, #7f1d1d, #6b1d1d);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(153, 27, 27, 0.4);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            border: none;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #7f1d1d, #6b1d1d);
            transform: translateY(-1px);
        }
        
        .badge-global {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
        }
        
        .badge-trainer {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
        }
        
        .alert {
            background: rgba(55, 65, 81, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(75, 85, 99, 0.3);
            color: #e5e7eb;
        }
        
        .alert-success {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        
        .alert-danger {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }
        
        .form-control, .form-select {
            background: rgba(55, 65, 81, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #e5e7eb;
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(55, 65, 81, 0.9);
            border-color: rgba(220, 38, 38, 0.5);
            color: #e5e7eb;
            box-shadow: 0 0 0 0.2rem rgba(220, 38, 38, 0.25);
        }
        
        .btn-xs {
            padding: 2px 8px;
            font-size: 0.75rem;
            border-radius: 4px;
        }
        
        .btn-outline-light {
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.8);
        }
        
        .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }
        
        .exercise-description {
            font-size: 0.9rem;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>

  <!-- Sidebar -->
  <nav class="sidebar d-flex flex-column">
    <div class="navbar-brand d-flex align-items-center mb-4">
      <img src="/assets/logo_flowfit_admin.png" alt="FlowFit" height="32" class="me-3 logo-admin" style="border-radius: 6px;">
      <span class="brand-text fs-4 fw-bold">FlowFit Admin</span>
    </div>
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item"><a th:href="@{/admin/dashboard}" class="nav-link"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a></li>
      <li><a th:href="@{/admin/usuarios-pendientes}" class="nav-link"><i class="bi bi-people me-2"></i> Usuarios Pendientes</a></li>
      <li><a th:href="@{/admin/usuarios}" class="nav-link"><i class="bi bi-person-badge me-2"></i> Gestión Usuarios</a></li>
      <li><a th:href="@{/admin/ejercicios}" class="nav-link active"><i class="bi bi-activity me-2"></i> Ejercicios</a></li>
    </ul>
    <div class="border-top pt-3 mt-auto text-white">
      <!-- Profile Section with Image -->
      <div class="dropdown profile-dropdown">
        <div class="profile-icon d-flex align-items-center w-100" id="profileDropdownAdmin" data-bs-toggle="dropdown" aria-expanded="false">
          <img src="/assets/perfil_default.png" alt="Profile" class="profile-image me-2" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
          <div class="flex-grow-1">
            <div class="small fw-bold" th:text="${usuario.nombre}">Administrador</div>
            <div class="small text-muted">Admin Panel</div>
          </div>
          <i class="bi bi-chevron-down"></i>
        </div>
        <ul class="dropdown-menu profile-menu" aria-labelledby="profileDropdownAdmin">
          <li><a class="dropdown-item" href="/admin/perfil"><i class="bi bi-person-gear me-2"></i>Mi Perfil</a></li>
          <li><a class="dropdown-item" href="/configuracion"><i class="bi bi-gear me-2"></i>Configuración</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <div class="main-content">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-0">Gestión de Ejercicios</h1>
        <small class="text-muted">Administra los ejercicios de la plataforma FlowFit</small>
      </div>
      <div class="d-flex gap-2">
        <a href="/admin/crear-ejercicio" class="btn btn-admin-primary">
          <i class="bi bi-plus-circle me-2"></i>Nuevo Ejercicio
        </a>
      </div>
    </div>

    <div class="container-fluid">
            <!-- Success/Error Messages -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="bi bi-check-circle me-2"></i>
                <span th:text="${success}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stats-card p-4 text-center">
                        <i class="bi bi-collection-play fs-1 text-primary mb-2"></i>
                        <h3 class="text-white" th:text="${totalEjercicios}">0</h3>
                        <p class="text-light mb-0">Total Ejercicios</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card p-4 text-center">
                        <i class="bi bi-globe fs-1 text-success mb-2"></i>
                        <h3 class="text-white" th:text="${totalGlobales}">0</h3>
                        <p class="text-light mb-0">Ejercicios Globales</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card p-4 text-center">
                        <i class="bi bi-people fs-1 text-warning mb-2"></i>
                        <h3 class="text-white" th:text="${totalEntrenadores}">0</h3>
                        <p class="text-light mb-0">Por Entrenadores</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card p-4 text-center">
                        <a th:href="@{/admin/ejercicios/crear}" class="btn btn-create btn-lg w-100">
                            <i class="bi bi-plus-circle me-2"></i>
                            Crear Ejercicio
                        </a>
                    </div>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="search-filters-card p-4 mb-4">
                <form method="get" th:action="@{/admin/ejercicios}" class="row g-3">
                    <div class="col-md-6">
                        <label for="search" class="form-label text-white">Buscar ejercicios:</label>
                        <input type="text" class="form-control" id="search" name="search" 
                               th:value="${search}" placeholder="Buscar por nombre o descripción...">
                    </div>
                    <div class="col-md-4">
                        <label for="filtro" class="form-label text-white">Filtrar por:</label>
                        <select class="form-select" id="filtro" name="filtro">
                            <option value="todos" th:selected="${filtro == 'todos'}">Todos los ejercicios</option>
                            <option value="globales" th:selected="${filtro == 'globales'}">Ejercicios globales</option>
                            <option value="entrenadores" th:selected="${filtro == 'entrenadores'}">Por entrenadores</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-create w-100">
                            <i class="bi bi-search me-2"></i>Buscar
                        </button>
                    </div>
                </form>
            </div>

            <!-- Exercises Grid -->
            <div class="row">
                <div class="col-12" th:if="${#lists.isEmpty(ejercicios)}">
                    <div class="text-center py-5">
                        <i class="bi bi-search display-1 text-muted"></i>
                        <h3 class="text-white mt-3">No se encontraron ejercicios</h3>
                        <p class="text-light">Intenta con diferentes criterios de búsqueda o crea un nuevo ejercicio.</p>
                        <a th:href="@{/admin/ejercicios/crear}" class="btn btn-create">
                            <i class="bi bi-plus-circle me-2"></i>Crear Primer Ejercicio
                        </a>
                    </div>
                </div>
                
                <div class="col-lg-4 col-md-6 mb-4" th:each="ejercicio : ${ejercicios}">
                    <div class="exercise-card h-100 d-flex flex-column">
                        <div class="card-body p-3 d-flex flex-column">
                            <!-- Header Row -->
                            <div class="row mb-3">
                                <div class="col-8">
                                    <h5 class="card-title text-white mb-0 text-truncate" th:text="${ejercicio.nombre}" th:title="${ejercicio.nombre}">Ejercicio</h5>
                                </div>
                                <div class="col-4 text-end">
                                    <span class="badge badge-global" th:if="${ejercicio.creadoPor == null}">
                                        <i class="bi bi-globe me-1"></i>Global
                                    </span>
                                    <span class="badge badge-trainer" th:if="${ejercicio.creadoPor != null}">
                                        <i class="bi bi-person me-1"></i>Entrenador
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Image Row -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="exercise-image-container" th:if="${ejercicio.imagen != null and ejercicio.imagen != ''}">
                                        <img th:src="@{'/ejercicio_image_uploads/' + ${ejercicio.imagen}}" 
                                             th:alt="${ejercicio.nombre}" 
                                             class="exercise-image">
                                    </div>
                                    <div th:if="${ejercicio.imagen == null or ejercicio.imagen == ''}" class="exercise-image bg-secondary d-flex align-items-center justify-content-center">
                                        <i class="bi bi-image display-4 text-light"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Description Row -->
                            <div class="row mb-3 flex-grow-1">
                                <div class="col-12">
                                    <p class="card-text text-light mb-0 exercise-description">
                                        <span th:text="${ejercicio.descripcion}">Descripción del ejercicio...</span>
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Creator Info Row -->
                            <div class="row mb-2" th:if="${ejercicio.creadoPor != null}">
                                <div class="col-12">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-person-circle me-1"></i>
                                        <strong th:text="${ejercicio.creadoPor.nombre}">Entrenador</strong>
                                    </small>
                                    <small class="text-muted d-block text-truncate" th:title="${ejercicio.creadoPor.correo}">
                                        <i class="bi bi-envelope me-1"></i>
                                        <span th:text="${ejercicio.creadoPor.correo}">correo@ejemplo.com</span>
                                    </small>
                                </div>
                            </div>

                            
                            <!-- Action Row -->
                            <div class="row mt-auto">
                                <div class="col-12 text-center">
                                    <!-- Edit Button -->
                                    <a th:href="@{'/admin/ejercicios/editar/' + ${ejercicio.id}}" class="btn btn-outline-light btn-sm me-2">
                                        <i class="bi bi-pencil me-1"></i>Editar
                                    </a>
                                    <!-- Delete Button -->
                                    <form method="post" th:action="@{'/admin/ejercicios/eliminar/' + ${ejercicio.id}}" 
                                          onsubmit="return confirm('¿Estás seguro de que deseas eliminar este ejercicio?');"
                                          class="d-inline">
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="bi bi-trash me-1"></i>Eliminar
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Back to Dashboard -->
            <div class="text-center mt-5 mb-4">
                <a th:href="@{/admin/dashboard}" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left me-2"></i>Volver al Dashboard
                </a>
            </div>
        </div>
        </div> <!-- Cierre de main-content -->
    </div> <!-- Cierre del container-fluid -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>