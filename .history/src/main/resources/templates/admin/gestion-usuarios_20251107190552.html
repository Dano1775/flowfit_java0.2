<!DOCTYPE html><!DOCTYPE html>

<html lang="es" xmlns:th="http://www.thymeleaf.org"><html lang="es" xmlns:th="http://www.thymeleaf.org">

<head><head>

  <meta charset="UTF-8">    <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Gesti√≥n de Usuarios - FlowFit Admin</title>    <title>Gesti√≥n de Usuarios - FlowFit Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap -->    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">

    <style>

  <!-- FlowFit CSS System -->        /* Fondo moderno con gradiente */

  <link th:href="@{/css/flowfit-base.css}" rel="stylesheet">        body {

  <link th:href="@{/css/flowfit-admin.css}" rel="stylesheet">            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);

</head>            min-height: 100vh;

<body>        }

        

  <!-- Desktop Toggle (for collapse) -->        .user-management-header {

  <button class="sidebar-collapse-btn d-none d-md-flex" id="sidebarCollapseBtn" title="Contraer/Expandir Sidebar">            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.15));

    <i class="bi bi-chevron-left"></i>            backdrop-filter: blur(20px);

  </button>            color: white;

            padding: 40px 0;

  <!-- Mobile Toggle -->            margin-bottom: 30px;

  <button class="sidebar-toggle-base sidebar-toggle-admin d-md-none" id="sidebarToggle">            border-radius: 0 0 20px 20px;

    <i class="bi bi-list fs-4"></i>            border-bottom: 3px solid #3b82f6;

  </button>            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);

        }

  <!-- Sidebar Overlay for Mobile -->        

  <div class="sidebar-overlay-base" id="sidebarOverlay"></div>        .stats-card {

            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));

  <!-- FlowFit Sidebar -->            backdrop-filter: blur(15px);

  <nav class="sidebar-base sidebar-admin d-flex flex-column" id="sidebar">            border: 1px solid rgba(59, 130, 246, 0.2);

    <!-- Brand -->            border-radius: 15px;

    <a th:href="@{/admin/dashboard}" class="navbar-brand d-flex align-items-center text-decoration-none">            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

      <img src="/assets/logo_flowfit_admin.png" alt="FlowFit Admin" height="40" class="me-3 logo-flowfit">            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);

      <span class="brand-text">FlowFit</span>        }

    </a>        

        .stats-card:hover {

    <!-- Navigation -->            transform: translateY(-8px) scale(1.02);

    <ul class="nav nav-pills flex-column mb-auto">            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);

      <li class="nav-item">            border-color: #3b82f6;

        <a th:href="@{/admin/dashboard}" class="nav-link-base nav-link-admin" title="Dashboard">        }

          <i class="bi bi-speedometer2 me-3"></i>         

          <span class="nav-text">Dashboard</span>        .filter-card {

        </a>            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));

      </li>            backdrop-filter: blur(20px);

      <li class="nav-item">            border: 1px solid rgba(59, 130, 246, 0.2);

        <a th:href="@{/admin/usuarios-pendientes}" class="nav-link-base nav-link-admin" title="Usuarios Pendientes">            border-radius: 15px;

          <i class="bi bi-people me-3"></i>             padding: 30px;

          <span class="nav-text">Usuarios Pendientes</span>            margin-bottom: 30px;

        </a>            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);

      </li>        }

      <li class="nav-item">        

        <a th:href="@{/admin/usuarios}" class="nav-link-base nav-link-admin active" title="Gesti√≥n Usuarios">        .user-table-card {

          <i class="bi bi-person-badge me-3"></i>             background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));

          <span class="nav-text">Gesti√≥n Usuarios</span>            backdrop-filter: blur(20px);

        </a>            border: 1px solid rgba(59, 130, 246, 0.2);

      </li>            border-radius: 15px;

      <li class="nav-item">            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);

        <a th:href="@{/admin/ejercicios}" class="nav-link-base nav-link-admin" title="Ejercicios">        }

          <i class="bi bi-activity me-3"></i>         

          <span class="nav-text">Ejercicios</span>        .user-table-card .card-header {

        </a>            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.1));

      </li>            border-bottom: 1px solid rgba(59, 130, 246, 0.3);

      <li class="nav-item">            padding: 20px 25px;

        <a th:href="@{/admin/correos}" class="nav-link-base nav-link-admin" title="Env√≠o Masivo">            border-radius: 15px 15px 0 0;

          <i class="bi bi-envelope me-3"></i>         }

          <span class="nav-text">Env√≠o Masivo</span>        

        </a>        .table-dark {

      </li>            background: transparent !important;

    </ul>        }

        

    <!-- Profile Section -->        .table-dark thead th {

    <div class="border-top pt-3 mt-auto">            background: rgba(59, 130, 246, 0.1);

      <div class="dropdown profile-dropdown-base">            border-color: rgba(59, 130, 246, 0.2);

        <div class="profile-icon-base d-flex align-items-center w-100" id="profileDropdownAdmin" data-bs-toggle="dropdown" aria-expanded="false">            color: #3b82f6;

          <img src="/assets/perfil_default.png" alt="Profile" class="profile-image-base me-2" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">            font-weight: 600;

          <div class="flex-grow-1">            text-transform: uppercase;

            <div class="small fw-bold text-white" th:text="${usuario != null ? #strings.substringBefore(usuario.nombre, ' ') : 'Admin'}">Admin</div>            font-size: 0.85rem;

            <div class="small text-muted-flowfit">Administrador</div>            letter-spacing: 0.5px;

          </div>            padding: 15px 12px;

          <i class="bi bi-chevron-down text-white"></i>        }

        </div>        

        <ul class="dropdown-menu" aria-labelledby="profileDropdownAdmin">        .table-dark tbody tr {

          <li><a class="dropdown-item" th:href="@{/admin/perfil}"><i class="bi bi-person me-2"></i>Mi Perfil</a></li>            border-color: rgba(59, 130, 246, 0.1);

          <li><hr class="dropdown-divider"></li>            transition: all 0.3s ease;

          <li><a class="dropdown-item text-danger" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesi√≥n</a></li>        }

        </ul>        

      </div>        .table-dark tbody tr:hover {

    </div>            background: rgba(59, 130, 246, 0.08);

  </nav>            transform: scale(1.01);

        }

  <!-- Main Content -->        

  <main class="main-content-base fade-in-up">        .status-badge {

    <div class="container-fluid">            padding: 8px 14px;

      <!-- Page Header -->            border-radius: 20px;

      <div class="d-flex justify-content-between align-items-center mb-4">            font-size: 0.8rem;

        <div>            font-weight: 600;

          <h1 class="h2 mb-2 text-white fw-bold">            display: inline-flex;

            <i class="bi bi-person-badge me-2 text-danger"></i>Gesti√≥n de Usuarios            align-items: center;

          </h1>            gap: 6px;

          <p class="text-muted-flowfit mb-0">Administra todos los usuarios del sistema FlowFit</p>        }

        </div>        

        <a th:href="@{/admin/dashboard}" class="btn btn-flowfit-outline btn-admin-outline">        .status-activo { 

          <i class="bi bi-arrow-left me-2"></i>Volver al Dashboard            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.15)); 

        </a>            color: #22c55e; 

      </div>            border: 1px solid #22c55e; 

            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);

      <!-- Alerts -->        }

      <div th:if="${success}" class="alert alert-success alert-dismissible fade show shadow-sm mb-4" role="alert">        .status-pendiente { 

        <i class="bi bi-check-circle-fill me-2"></i>            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.15)); 

        <strong>¬°√âxito!</strong> <span th:text="${success}"></span>            color: #fbbf24; 

        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>            border: 1px solid #fbbf24; 

      </div>            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);

        }

      <div th:if="${error}" class="alert alert-danger alert-dismissible fade show shadow-sm mb-4" role="alert">        .status-rechazado { 

        <i class="bi bi-exclamation-triangle-fill me-2"></i>            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.15)); 

        <strong>Error:</strong> <span th:text="${error}"></span>            color: #ef4444; 

        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>            border: 1px solid #ef4444; 

      </div>            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);

        }

      <!-- Statistics Cards -->        

      <div class="row g-3 mb-4">        .profile-badge {

        <div class="col-xl-3 col-md-6">            padding: 6px 12px;

          <div class="card-base card-admin h-100">            border-radius: 15px;

            <div class="card-body d-flex align-items-center">            font-size: 0.75rem;

              <div class="flex-shrink-0 me-3">            font-weight: 600;

                <div class="icon-box-admin bg-primary-subtle text-primary">            display: inline-flex;

                  <i class="bi bi-people-fill fs-4"></i>            align-items: center;

                </div>            gap: 4px;

              </div>        }

              <div class="flex-grow-1">        

                <h6 class="text-muted-flowfit small mb-1">Total Usuarios</h6>        .profile-entrenador { 

                <h3 class="text-white mb-0 fw-bold" th:text="${totalUsuarios ?: 0}">0</h3>            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(37, 99, 235, 0.15)); 

              </div>            color: #3b82f6; 

            </div>            border: 1px solid rgba(59, 130, 246, 0.4);

          </div>        }

        </div>        .profile-nutricionista { 

        <div class="col-xl-3 col-md-6">            background: linear-gradient(135deg, rgba(251, 191, 36, 0.25), rgba(245, 158, 11, 0.15)); 

          <div class="card-base card-admin h-100">            color: #fbbf24; 

            <div class="card-body d-flex align-items-center">            border: 1px solid rgba(251, 191, 36, 0.4);

              <div class="flex-shrink-0 me-3">        }

                <div class="icon-box-admin bg-success-subtle text-success">        .profile-usuario { 

                  <i class="bi bi-check-circle-fill fs-4"></i>            background: linear-gradient(135deg, rgba(34, 197, 94, 0.25), rgba(22, 163, 74, 0.15)); 

                </div>            color: #22c55e; 

              </div>            border: 1px solid rgba(34, 197, 94, 0.4);

              <div class="flex-grow-1">        }

                <h6 class="text-muted-flowfit small mb-1">Activos</h6>        .profile-administrador { 

                <h3 class="text-white mb-0 fw-bold" th:text="${usuariosActivos ?: 0}">0</h3>            background: linear-gradient(135deg, rgba(239, 68, 68, 0.25), rgba(220, 38, 38, 0.15)); 

              </div>            color: #ef4444; 

            </div>            border: 1px solid rgba(239, 68, 68, 0.4);

          </div>        }

        </div>        

        <div class="col-xl-3 col-md-6">        .action-buttons .btn {

          <div class="card-base card-admin h-100">            margin: 2px;

            <div class="card-body d-flex align-items-center">            padding: 8px 12px;

              <div class="flex-shrink-0 me-3">            border-radius: 10px;

                <div class="icon-box-admin bg-warning-subtle text-warning">            font-size: 0.85rem;

                  <i class="bi bi-hourglass-split fs-4"></i>            transition: all 0.3s ease;

                </div>            border-width: 2px;

              </div>        }

              <div class="flex-grow-1">        

                <h6 class="text-muted-flowfit small mb-1">Pendientes</h6>        .btn-outline-purple {

                <h3 class="text-white mb-0 fw-bold" th:text="${usuariosPendientes ?: 0}">0</h3>            color: #8b5cf6;

              </div>            border-color: #8b5cf6;

            </div>        }

          </div>        

        </div>        .btn-outline-purple:hover {

        <div class="col-xl-3 col-md-6">            background-color: #8b5cf6;

          <div class="card-base card-admin h-100">            border-color: #8b5cf6;

            <div class="card-body d-flex align-items-center">            color: white;

              <div class="flex-shrink-0 me-3">            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);

                <div class="icon-box-admin bg-danger-subtle text-danger">        }

                  <i class="bi bi-x-circle-fill fs-4"></i>        

                </div>        .btn-outline-info:hover {

              </div>            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);

              <div class="flex-grow-1">        }

                <h6 class="text-muted-flowfit small mb-1">Rechazados</h6>        

                <h3 class="text-white mb-0 fw-bold" th:text="${usuariosRechazados ?: 0}">0</h3>        .btn-outline-warning:hover {

              </div>            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);

            </div>        }

          </div>        

        </div>        .btn-outline-success:hover {

      </div>            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);

        }

      <!-- Search and Filter Card -->        

      <div class="card-base card-admin mb-4">        .btn-outline-danger:hover {

        <div class="card-body p-4">            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);

          <form method="get" th:action="@{/admin/usuarios}" class="row g-3">        }

            <div class="col-md-4">        

              <label class="form-label text-white fw-semibold">        .search-box {

                <i class="bi bi-search me-2"></i>Buscar Usuario            background: rgba(15, 23, 42, 0.8);

              </label>            border: 2px solid rgba(59, 130, 246, 0.3);

              <input type="text" name="search" th:value="${search}"             color: #e5e7eb;

                     class="form-control form-control-flowfit"             border-radius: 12px;

                     placeholder="Nombre, correo o documento...">            padding: 12px 18px;

            </div>            transition: all 0.3s ease;

            <div class="col-md-3">        }

              <label class="form-label text-white fw-semibold">        

                <i class="bi bi-funnel me-2"></i>Filtrar por        .search-box:focus {

              </label>            background: rgba(15, 23, 42, 0.95);

              <select name="filtro" class="form-select form-control-flowfit">            border-color: #3b82f6;

                <option value="todos" th:selected="${filtro == 'todos'}">Todos los usuarios</option>            box-shadow: 0 0 0 0.3rem rgba(59, 130, 246, 0.25), 0 0 20px rgba(59, 130, 246, 0.3);

                <option value="activos" th:selected="${filtro == 'activos'}">Activos</option>            color: #ffffff;

                <option value="pendientes" th:selected="${filtro == 'pendientes'}">Pendientes</option>        }

                <option value="rechazados" th:selected="${filtro == 'rechazados'}">Rechazados</option>        

                <option value="entrenadores" th:selected="${filtro == 'entrenadores'}">Entrenadores</option>        .filter-select {

                <option value="nutricionistas" th:selected="${filtro == 'nutricionistas'}">Nutricionistas</option>            background: rgba(15, 23, 42, 0.8);

                <option value="usuarios" th:selected="${filtro == 'usuarios'}">Usuarios</option>            border: 2px solid rgba(59, 130, 246, 0.3);

              </select>            color: #e5e7eb;

            </div>            border-radius: 12px;

            <div class="col-md-3">            padding: 12px 18px;

              <label class="form-label text-transparent">.</label>            transition: all 0.3s ease;

              <button type="submit" class="btn btn-flowfit-admin w-100">        }

                <i class="bi bi-search me-2"></i>Buscar        

              </button>        .filter-select:focus {

            </div>            background: rgba(15, 23, 42, 0.95);

            <div class="col-md-2">            border-color: #3b82f6;

              <label class="form-label text-transparent">.</label>            box-shadow: 0 0 0 0.3rem rgba(59, 130, 246, 0.25), 0 0 20px rgba(59, 130, 246, 0.3);

              <a th:href="@{/admin/usuarios}" class="btn btn-flowfit-outline btn-admin-outline w-100">            color: #ffffff;

                <i class="bi bi-arrow-clockwise me-2"></i>Limpiar        }

              </a>        

            </div>        .empty-state {

          </form>            padding: 80px 20px;

        </div>            text-align: center;

      </div>        }

        

      <!-- Users Table Card -->        .empty-state i {

      <div class="card-base card-admin mb-4">            font-size: 5rem;

        <div class="card-header bg-transparent border-0 pt-4 px-4 pb-0">            color: rgba(59, 130, 246, 0.3);

          <div class="d-flex align-items-center justify-content-between">            margin-bottom: 20px;

            <div>            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.4));

              <h5 class="card-title text-white fw-bold mb-1">        }

                <i class="bi bi-table me-2 text-danger"></i>Lista de Usuarios        

              </h5>        /* Botones modernos */

              <p class="text-muted-flowfit small mb-0">        .btn-success {

                Mostrando <span th:text="${usuarios != null ? usuarios.size() : 0}">0</span> usuario(s)            background: linear-gradient(135deg, #22c55e, #16a34a);

                <span th:if="${search != null and !search.isEmpty()}">            border: none;

                  para "<strong th:text="${search}"></strong>"            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);

                </span>        }

              </p>        

            </div>        .btn-success:hover {

          </div>            background: linear-gradient(135deg, #16a34a, #15803d);

        </div>            box-shadow: 0 6px 25px rgba(34, 197, 94, 0.5);

                    transform: translateY(-2px);

        <div class="card-body p-4">        }

          <!-- Empty state -->        

          <div th:if="${usuarios == null or usuarios.isEmpty()}" class="text-center py-5">        .btn-outline-light {

            <i class="bi bi-inbox text-muted-flowfit" style="font-size: 4rem; opacity: 0.5;"></i>            border-width: 2px;

            <p class="text-muted-flowfit mt-3 mb-0">No se encontraron usuarios</p>            border-color: rgba(255, 255, 255, 0.3);

            <p class="text-muted-flowfit small">Intenta ajustar los filtros de b√∫squeda</p>            color: #ffffff;

          </div>        }

        

          <!-- Users table -->        .btn-outline-light:hover {

          <div th:if="${usuarios != null and !usuarios.isEmpty()}" class="table-responsive">            background: rgba(255, 255, 255, 0.1);

            <table class="table table-dark table-hover align-middle mb-0">            border-color: #ffffff;

              <thead class="border-bottom border-danger border-opacity-25">            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);

                <tr>        }

                  <th class="text-muted-flowfit fw-semibold py-3">ID</th>        

                  <th class="text-muted-flowfit fw-semibold py-3">Usuario</th>        /* Animaciones */

                  <th class="text-muted-flowfit fw-semibold py-3">Contacto</th>        @keyframes fadeIn {

                  <th class="text-muted-flowfit fw-semibold py-3">Perfil</th>            from { opacity: 0; transform: translateY(20px); }

                  <th class="text-muted-flowfit fw-semibold py-3">Estado</th>            to { opacity: 1; transform: translateY(0); }

                  <th class="text-muted-flowfit fw-semibold py-3 text-center">Acciones</th>        }

                </tr>        

              </thead>        .stats-card, .filter-card, .user-table-card {

              <tbody>            animation: fadeIn 0.6s ease-out;

                <tr th:each="u : ${usuarios}">        }

                  <td class="text-white fw-semibold" th:text="${u.id}">1</td>        

                  <td>        /* Estilo para las alertas */

                    <div class="text-white fw-semibold" th:text="${u.nombre}">Usuario</div>        .alert {

                    <small class="text-muted-flowfit" th:text="${u.numeroDocumento}">123456789</small>            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));

                  </td>            border: 1px solid;

                  <td>            border-radius: 12px;

                    <div class="text-white">            backdrop-filter: blur(10px);

                      <i class="bi bi-envelope me-1"></i><span th:text="${u.correo}">email@ejemplo.com</span>        }

                    </div>        

                    <small class="text-muted-flowfit">        .alert-success {

                      <i class="bi bi-telephone me-1"></i><span th:text="${u.telefono}">123456789</span>            border-color: #22c55e;

                    </small>            color: #22c55e;

                  </td>        }

                  <td>        

                    <div th:switch="${u.perfilUsuario.toString()}">        .alert-danger {

                      <span th:case="'Entrenador'" class="badge bg-primary-subtle text-primary">            border-color: #ef4444;

                        <i class="bi bi-person-arms-up me-1"></i>Entrenador            color: #ef4444;

                      </span>        }

                      <span th:case="'Nutricionista'" class="badge bg-warning-subtle text-warning">    </style>

                        <i class="bi bi-heart-pulse me-1"></i>Nutricionista</head>

                      </span><body class="dashboard-bg">

                      <span th:case="'Administrador'" class="badge bg-danger-subtle text-danger">

                        <i class="bi bi-shield-fill-check me-1"></i>Administrador

                      </span>  <!-- Sidebar -->

                      <span th:case="*" class="badge bg-success-subtle text-success">  <nav class="sidebar d-flex flex-column">

                        <i class="bi bi-person-fill me-1"></i>Usuario    <div class="navbar-brand d-flex align-items-center mb-4">

                      </span>      <img src="/assets/logo_flowfit_admin.png" alt="FlowFit" height="32" class="me-3 logo-admin" style="border-radius: 6px;">

                    </div>      <span class="brand-text fs-4 fw-bold">FlowFit Admin</span>

                  </td>    </div>

                  <td>    <ul class="nav nav-pills flex-column mb-auto">

                    <div th:switch="${u.estado}">      <li class="nav-item"><a th:href="@{/admin/dashboard}" class="nav-link"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a></li>

                      <span th:case="'A'" class="badge bg-success-subtle text-success">      <li><a th:href="@{/admin/usuarios-pendientes}" class="nav-link"><i class="bi bi-people me-2"></i> Usuarios Pendientes</a></li>

                        <i class="bi bi-check-circle-fill me-1"></i>Activo      <li><a th:href="@{/admin/usuarios}" class="nav-link active"><i class="bi bi-person-badge me-2"></i> Gesti√≥n Usuarios</a></li>

                      </span>      <li><a th:href="@{/admin/ejercicios}" class="nav-link"><i class="bi bi-activity me-2"></i> Ejercicios</a></li>

                      <span th:case="'I'" class="badge bg-warning-subtle text-warning">    </ul>

                        <i class="bi bi-hourglass-split me-1"></i>Pendiente    <div class="border-top pt-3 mt-auto text-white">

                      </span>      <!-- Profile Section with Image -->

                      <span th:case="'R'" class="badge bg-danger-subtle text-danger">      <div class="dropdown profile-dropdown">

                        <i class="bi bi-x-circle-fill me-1"></i>Rechazado        <div class="profile-icon d-flex align-items-center w-100" id="profileDropdownAdmin" data-bs-toggle="dropdown" aria-expanded="false">

                      </span>          <img src="/assets/perfil_default.png" alt="Profile" class="profile-image me-2" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">

                    </div>          <div class="flex-grow-1">

                  </td>            <div class="small fw-bold" th:text="${usuario.nombre}">Administrador</div>

                  <td class="text-center">            <div class="small text-muted">Admin Panel</div>

                    <div class="btn-group" role="group">          </div>

                      <!-- Ver detalles -->          <i class="bi bi-chevron-down"></i>

                      <button class="btn btn-sm btn-outline-info" th:onclick="'viewUser(' + ${u.id} + ')'" title="Ver detalles">        </div>

                        <i class="bi bi-eye"></i>        <ul class="dropdown-menu profile-menu" aria-labelledby="profileDropdownAdmin">

                      </button>          <li><a class="dropdown-item" href="/admin/perfil"><i class="bi bi-person-gear me-2"></i>Mi Perfil</a></li>

                                <li><a class="dropdown-item" href="/configuracion"><i class="bi bi-gear me-2"></i>Configuraci√≥n</a></li>

                      <!-- Editar (no admins) -->          <li><hr class="dropdown-divider"></li>

                      <button th:if="${u.perfilUsuario.toString() != 'Administrador'}"           <li><a class="dropdown-item text-danger" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesi√≥n</a></li>

                              class="btn btn-sm btn-outline-warning"         </ul>

                              th:onclick="'editUser(' + ${u.id} + ')'"       </div>

                              title="Editar">    </div>

                        <i class="bi bi-pencil"></i>  </nav>

                      </button>

                          <!-- Main content -->

                      <!-- Aprobar (pendientes no usuarios) -->    <div class="main-content">

                      <button th:if="${u.estado == 'I' && u.perfilUsuario.toString() != 'Usuario' && u.perfilUsuario.toString() != 'Administrador'}"         <!-- Header -->

                              class="btn btn-sm btn-outline-success"         <div class="user-management-header text-center">

                              th:onclick="'approveUser(' + ${u.id} + ')'"             <div class="container">

                              title="Aprobar">                <h1><i class="bi bi-people-fill me-3"></i>Gesti√≥n de Usuarios</h1>

                        <i class="bi bi-check-lg"></i>                <p class="lead mb-0">Sistema de administraci√≥n y gesti√≥n de usuarios FlowFit</p>

                      </button>            </div>

                              </div>

                      <!-- Rechazar (pendientes no usuarios) -->

                      <button th:if="${u.estado == 'I' && u.perfilUsuario.toString() != 'Usuario' && u.perfilUsuario.toString() != 'Administrador'}"         <div class="container-fluid">

                              class="btn btn-sm btn-outline-danger"             <!-- Success/Error Messages -->

                              th:onclick="'rejectUser(' + ${u.id} + ')'"             <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">

                              title="Rechazar">                <i class="bi bi-check-circle me-2"></i>

                        <i class="bi bi-x-lg"></i>                <span th:text="${success}">Operaci√≥n exitosa</span>

                      </button>                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>

                                  </div>

                      <!-- Desactivar (activos no admins) -->            

                      <button th:if="${u.estado == 'A' && u.perfilUsuario.toString() != 'Administrador'}"             <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">

                              class="btn btn-sm btn-outline-secondary"                 <i class="bi bi-exclamation-triangle me-2"></i>

                              th:onclick="'deactivateUser(' + ${u.id} + ')'"                 <span th:text="${error}">Error en la operaci√≥n</span>

                              title="Desactivar">                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>

                        <i class="bi bi-pause-circle"></i>            </div>

                      </button>

                                  <!-- Statistics Cards -->

                      <!-- Activar (inactivos usuarios) -->            <div class="row mb-4">

                      <button th:if="${u.estado == 'I' && u.perfilUsuario.toString() == 'Usuario'}"                 <div class="col-xl-3 col-md-6 mb-3">

                              class="btn btn-sm btn-outline-success"                     <div class="stats-card card text-white">

                              th:onclick="'activateUser(' + ${u.id} + ')'"                         <div class="card-body">

                              title="Activar">                            <div class="d-flex justify-content-between">

                        <i class="bi bi-play-circle"></i>                                <div>

                      </button>                                    <h4 class="mb-0" th:text="${totalUsuarios ?: 0}">0</h4>

                                                          <div class="small">Total Usuarios</div>

                      <!-- Eliminar (no admins) -->                                </div>

                      <button th:if="${u.perfilUsuario.toString() != 'Administrador'}"                                 <i class="bi bi-people fs-1 text-primary opacity-75"></i>

                              class="btn btn-sm btn-outline-danger"                             </div>

                              th:onclick="'deleteUser(' + ${u.id} + ', \'' + ${u.nombre} + '\')'"                         </div>

                              title="Eliminar">                    </div>

                        <i class="bi bi-trash"></i>                </div>

                      </button>                <div class="col-xl-3 col-md-6 mb-3">

                    </div>                    <div class="stats-card card text-white">

                                            <div class="card-body">

                    <!-- Indicador para admins protegidos -->                            <div class="d-flex justify-content-between">

                    <div th:if="${u.perfilUsuario.toString() == 'Administrador'}" class="mt-2">                                <div>

                      <span class="badge bg-warning text-dark">                                    <h4 class="mb-0 text-success" th:text="${usuariosActivos ?: 0}">0</h4>

                        <i class="bi bi-shield-lock me-1"></i>Protegido                                    <div class="small">Usuarios Activos</div>

                      </span>                                </div>

                    </div>                                <i class="bi bi-check-circle fs-1 text-success opacity-75"></i>

                  </td>                            </div>

                </tr>                        </div>

              </tbody>                    </div>

            </table>                </div>

          </div>                <div class="col-xl-3 col-md-6 mb-3">

        </div>                    <div class="stats-card card text-white">

      </div>                        <div class="card-body">

                            <div class="d-flex justify-content-between">

    </div>                                <div>

  </main>                                    <h4 class="mb-0 text-warning" th:text="${usuariosPendientes ?: 0}">0</h4>

                                    <div class="small">Pendientes</div>

  <!-- JavaScript Functions -->                                </div>

  <script>                                <i class="bi bi-clock fs-1 text-warning opacity-75"></i>

    function viewUser(id) {                            </div>

      alert('Ver detalles del usuario ID: ' + id);                        </div>

    }                    </div>

                    </div>

    function editUser(id) {                <div class="col-xl-3 col-md-6 mb-3">

      window.location.href = '/admin/usuarios/editar/' + id;                    <div class="stats-card card text-white">

    }                        <div class="card-body">

                                <div class="d-flex justify-content-between">

    function approveUser(id) {                                <div>

      if (confirm('¬øEst√° seguro de aprobar este usuario?')) {                                    <h4 class="mb-0 text-danger" th:text="${usuariosRechazados ?: 0}">0</h4>

        window.location.href = '/admin/aprobar-usuario?id=' + id;                                    <div class="small">Rechazados</div>

      }                                </div>

    }                                <i class="bi bi-x-circle fs-1 text-danger opacity-75"></i>

                                </div>

    function rejectUser(id) {                        </div>

      const motivo = prompt('Ingrese el motivo del rechazo:');                    </div>

      if (motivo) {                </div>

        window.location.href = '/admin/rechazar-usuario?id=' + id + '&motivo=' + encodeURIComponent(motivo);            </div>

      }

    }            <!-- Search and Filter Section -->

                <div class="filter-card">

    function deactivateUser(id) {                <form method="get" th:action="@{/admin/usuarios}" class="row align-items-end">

      if (confirm('¬øEst√° seguro de desactivar este usuario? El usuario pasar√° a estado inactivo.')) {                    <div class="col-md-4 mb-3">

        window.location.href = '/admin/desactivar-usuario?id=' + id;                        <label class="form-label text-light fw-bold">

      }                            <i class="bi bi-search me-2"></i>Buscar Usuario

    }                        </label>

                            <input type="text" name="search" th:value="${search}" 

    function activateUser(id) {                               class="form-control search-box" 

      if (confirm('¬øEst√° seguro de activar este usuario? El usuario podr√° acceder al sistema nuevamente.')) {                               placeholder="Nombre, email o documento...">

        window.location.href = '/admin/activar-usuario?id=' + id;                    </div>

      }                    <div class="col-md-3 mb-3">

    }                        <label class="form-label text-light fw-bold">

                                <i class="bi bi-funnel me-2"></i>Filtrar por

    function deleteUser(id, nombre) {                        </label>

      if (confirm('‚ö†Ô∏è ATENCI√ìN: ¬øEst√° seguro de ELIMINAR PERMANENTEMENTE al usuario "' + nombre + '"?\n\nEsta acci√≥n NO se puede deshacer y se eliminar√°n todos los datos asociados.')) {                        <select name="filtro" class="form-select filter-select">

        if (confirm('Confirme nuevamente que desea eliminar a "' + nombre + '". Esta es su √∫ltima oportunidad para cancelar.')) {                            <option value="todos" th:selected="${filtro == 'todos'}">Todos los usuarios</option>

          window.location.href = '/admin/eliminar-usuario?id=' + id;                            <option value="activos" th:selected="${filtro == 'activos'}">Activos</option>

        }                            <option value="pendientes" th:selected="${filtro == 'pendientes'}">Pendientes</option>

      }                            <option value="rechazados" th:selected="${filtro == 'rechazados'}">Rechazados</option>

    }                            <option value="entrenadores" th:selected="${filtro == 'entrenadores'}">Entrenadores</option>

  </script>                            <option value="nutricionistas" th:selected="${filtro == 'nutricionistas'}">Nutricionistas</option>

                            <option value="usuarios" th:selected="${filtro == 'usuarios'}">Usuarios</option>

  <!-- Bootstrap JS -->                        </select>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>                    </div>

                      <div class="col-md-3 mb-3">

  <!-- FlowFit Sidebar JS -->                        <button type="submit" class="btn btn-success w-100">

  <script th:src="@{/js/flowfit-sidebar.js}"></script>                            <i class="bi bi-search me-2"></i>Buscar

</body>                        </button>

</html>                    </div>

                    <div class="col-md-2 mb-3">
                        <a th:href="@{/admin/usuarios}" class="btn btn-outline-light w-100">
                            <i class="bi bi-arrow-clockwise me-2"></i>Limpiar
                        </a>
                    </div>
                </form>
            </div>

            <!-- Users Table -->
            <div class="user-table-card">
                <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-0 text-light">
                            <i class="bi bi-table me-2"></i>Lista de Usuarios
                        </h5>
                        <small class="text-muted">Gestiona todos los usuarios del sistema</small>
                    </div>
                    <div>
                        <button class="btn btn-outline-success btn-sm me-2" onclick="exportToExcel()">
                            <i class="bi bi-file-earmark-excel me-1"></i>Exportar Excel
                        </button>
                        <a href="/admin/historial-ediciones" class="btn btn-outline-info btn-sm">
                            <i class="bi bi-clock-history me-1"></i>Historial de Ediciones
                        </a>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- Empty state -->
                    <div th:if="${usuarios == null or usuarios.isEmpty()}" class="empty-state">
                        <i class="bi bi-inbox-fill"></i>
                        <h4 class="text-light">No se encontraron usuarios</h4>
                        <p class="text-muted">Intenta ajustar los filtros de b√∫squeda o crear un nuevo usuario</p>
                    </div>

                    <!-- Users table -->
                    <div th:if="${usuarios != null and not usuarios.isEmpty()}" class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Usuario</th>
                                    <th>Contacto</th>
                                    <th>Perfil</th>
                                    <th>Estado</th>
                                    <th>Fecha Registro</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="u : ${usuarios}">
                                    <td class="align-middle">
                                        <strong th:text="${u.id}">1</strong>
                                    </td>
                                    <td class="align-middle">
                                        <div>
                                            <strong th:text="${u.nombre}">Usuario</strong><br>
                                            <small class="text-muted" th:text="${u.numeroDocumento}">123456789</small>
                                        </div>
                                    </td>
                                    <td class="align-middle">
                                        <div>
                                            <i class="bi bi-envelope me-1"></i><span th:text="${u.correo}">email@ejemplo.com</span><br>
                                            <small class="text-muted"><i class="bi bi-telephone me-1"></i><span th:text="${u.telefono}">123456789</span></small>
                                        </div>
                                    </td>
                                    <td class="align-middle">
                                        <div th:switch="${u.perfilUsuario.toString()}">
                                            <span th:case="'Entrenador'" class="profile-badge profile-entrenador">üèãÔ∏è Entrenador</span>
                                            <span th:case="'Nutricionista'" class="profile-badge profile-nutricionista">ü•ó Nutricionista</span>
                                            <span th:case="'Administrador'" class="profile-badge profile-administrador">üë®‚Äçüíº Administrador</span>
                                            <span th:case="*" class="profile-badge profile-usuario">üë§ Usuario</span>
                                        </div>
                                    </td>
                                    <td class="align-middle">
                                        <div th:switch="${u.estado}">
                                            <span th:case="'A'" class="status-badge status-activo">Activo</span>
                                            <span th:case="'I'" class="status-badge status-pendiente">Pendiente</span>
                                            <span th:case="'R'" class="status-badge status-rechazado">Rechazado</span>
                                        </div>
                                    </td>
                                    <td class="align-middle">
                                        <small class="text-muted">No disponible</small>
                                    </td>
                                    <td class="text-center align-middle">
                                        <div class="action-buttons">
                                            <!-- Always show view details button -->
                                            <button class="btn btn-outline-info btn-sm" th:onclick="'viewUser(' + ${u.id} + ')'" title="Ver detalles">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            
                                            <!-- Only show edit button for non-admin users -->
                                            <button th:if="${u.perfilUsuario != 'Administrador'}" class="btn btn-outline-warning btn-sm" th:onclick="'editUser(' + ${u.id} + ')'" title="Editar">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            
                                            <!-- Always show history button -->
                                            <button class="btn btn-outline-purple btn-sm" th:onclick="'viewHistory(' + ${u.id} + ')'" title="Ver Historial de Ediciones">
                                                <i class="bi bi-clock-history"></i>
                                            </button>
                                            
                                            <!-- Status change buttons only for non-admin users -->
                                            <button th:if="${u.estado == 'I' && u.perfilUsuario != 'Usuario' && u.perfilUsuario != 'Administrador'}" class="btn btn-outline-success btn-sm" 
                                                    th:onclick="'approveUser(' + ${u.id} + ')'" title="Aprobar">
                                                <i class="bi bi-check-lg"></i>
                                            </button>
                                            <button th:if="${u.estado == 'I' && u.perfilUsuario != 'Usuario' && u.perfilUsuario != 'Administrador'}" class="btn btn-outline-danger btn-sm" 
                                                    th:onclick="'rejectUser(' + ${u.id} + ')'" title="Rechazar">
                                                <i class="bi bi-x-lg"></i>
                                            </button>
                                            <button th:if="${u.estado == 'A' && u.perfilUsuario != 'Administrador'}" class="btn btn-outline-secondary btn-sm" 
                                                    th:onclick="'deactivateUser(' + ${u.id} + ')'" title="Desactivar">
                                                <i class="bi bi-pause-circle"></i>
                                            </button>
                                            <button th:if="${u.estado == 'I' && u.perfilUsuario == 'Usuario'}" class="btn btn-outline-success btn-sm" 
                                                    th:onclick="'activateUser(' + ${u.id} + ')'" title="Activar Usuario">
                                                <i class="bi bi-play-circle"></i>
                                            </button>
                                            
                                            <!-- Delete button for non-admin users -->
                                            <button th:if="${u.perfilUsuario != 'Administrador'}" class="btn btn-outline-danger btn-sm" 
                                                    th:onclick="'deleteUser(' + ${u.id} + ', \'' + ${u.nombre} + '\')'" title="Eliminar Usuario">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                            
                                            <!-- Special indicator for admin users -->
                                            <span th:if="${u.perfilUsuario == 'Administrador'}" class="badge bg-warning text-dark ms-2" title="Los administradores no pueden ser editados ni eliminados">
                                                <i class="bi bi-shield-lock"></i> Protegido
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Results summary -->
                    <div th:if="${usuarios != null and not usuarios.isEmpty()}" class="mt-3 text-center">
                        <small class="text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            Mostrando <strong th:text="${usuarios.size()}">0</strong> usuarios
                            <span th:if="${search != null and !search.isEmpty()}">
                                para la b√∫squeda "<strong th:text="${search}">t√©rmino</strong>"
                            </span>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Back to Dashboard -->
            <div class="text-center mt-4">
                <a th:href="@{/admin/dashboard}" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left me-2"></i>Volver al Dashboard
                </a>
            </div>
        </div>
    </div> <!-- Cierre de main-content -->

    <!-- JavaScript Functions -->
    <script>
        function viewUser(id) {
            // TODO: Implement user details modal
            alert('Ver detalles del usuario ID: ' + id);
        }
        
        function editUser(id) {
            // TODO: Implement user editing
            window.location.href = '/admin/usuarios/editar/' + id;
        }
        
        function viewHistory(id) {
            window.location.href = '/admin/usuarios/' + id + '/historial';
        }
        
        function approveUser(id) {
            if (confirm('¬øEst√° seguro de aprobar este usuario?')) {
                window.location.href = '/admin/aprobar-usuario?id=' + id;
            }
        }
        
        function rejectUser(id) {
            if (confirm('¬øEst√° seguro de rechazar este usuario?')) {
                window.location.href = '/admin/rechazar-usuario?id=' + id;
            }
        }
        
        function deactivateUser(id) {
            if (confirm('¬øEst√° seguro de desactivar este usuario? El usuario pasar√° a estado inactivo.')) {
                window.location.href = '/admin/desactivar-usuario?id=' + id;
            }
        }
        
        function activateUser(id) {
            if (confirm('¬øEst√° seguro de activar este usuario? El usuario podr√° acceder al sistema nuevamente.')) {
                window.location.href = '/admin/activar-usuario?id=' + id;
            }
        }
        
        function deleteUser(id, nombre) {
            if (confirm('‚ö†Ô∏è ATENCI√ìN: ¬øEst√° seguro de ELIMINAR PERMANENTEMENTE al usuario "' + nombre + '"?\n\nEsta acci√≥n NO se puede deshacer y se eliminar√°n todos los datos asociados.')) {
                if (confirm('Confirme nuevamente que desea eliminar a "' + nombre + '". Esta es su √∫ltima oportunidad para cancelar.')) {
                    window.location.href = '/admin/eliminar-usuario?id=' + id;
                }
            }
        }
        
        function exportToExcel() {
            window.location.href = '/admin/exportar-usuarios-excel';
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>