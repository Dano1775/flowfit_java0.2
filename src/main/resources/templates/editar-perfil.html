<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editar Perfil - FlowFit</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <!-- FlowFit CSS System -->
  <link th:href="@{/css/flowfit-base.css}" rel="stylesheet">
  <link th:href="@{/css/flowfit-entrenador.css}" rel="stylesheet">
</head>
<body>

  <!-- Desktop Toggle (for collapse) -->
  <button class="sidebar-collapse-btn d-none d-md-flex" id="sidebarCollapseBtn" title="Contraer/Expandir Sidebar">
    <i class="bi bi-chevron-left"></i>
  </button>

  <!-- Mobile Toggle -->
  <button class="sidebar-toggle-base sidebar-toggle-entrenador d-md-none" id="sidebarToggle">
    <i class="bi bi-list fs-4"></i>
  </button>

  <!-- Sidebar Overlay for Mobile -->
  <div class="sidebar-overlay-base" id="sidebarOverlay"></div>

  <!-- FlowFit Sidebar -->
  <nav class="sidebar-base sidebar-entrenador d-flex flex-column" id="sidebar">
    <!-- Brand -->
    <a th:href="@{/entrenador/dashboard}" class="navbar-brand d-flex align-items-center text-decoration-none">
      <img src="/assets/logo_flowfit.png" alt="FlowFit Entrenador" height="40" class="me-3 logo-flowfit">
      <span class="brand-text">FlowFit</span>
    </a>

    <!-- Navigation -->
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item">
        <a th:href="@{/entrenador/dashboard}" class="nav-link-base nav-link-entrenador" title="Dashboard">
          <i class="bi bi-speedometer2 me-3"></i> 
          <span class="nav-text">Dashboard</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/entrenador/rutinas}" class="nav-link-base nav-link-entrenador" title="Rutinas">
          <i class="bi bi-clipboard-data me-3"></i> 
          <span class="nav-text">Rutinas</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/entrenador/ejercicios}" class="nav-link-base nav-link-entrenador" title="Ejercicios">
          <i class="bi bi-activity me-3"></i> 
          <span class="nav-text">Ejercicios</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/entrenador/mis-usuarios}" class="nav-link-base nav-link-entrenador" title="Mis Usuarios">
          <i class="bi bi-people me-3"></i> 
          <span class="nav-text">Mis Usuarios</span>
        </a>
      </li>
      <li class="nav-item">
        <a th:href="@{/entrenador/asignar-rutinas}" class="nav-link-base nav-link-entrenador" title="Asignar Rutinas">
          <i class="bi bi-person-check me-3"></i> 
          <span class="nav-text">Asignar Rutinas</span>
        </a>
      </li>
    </ul>

    <!-- Profile Section -->
    <div class="border-top pt-3 mt-auto">
      <div class="dropdown profile-dropdown-base">
        <div class="profile-icon-base d-flex align-items-center w-100" id="profileDropdownEntrenador" data-bs-toggle="dropdown" aria-expanded="false">
          <img src="/assets/perfil_default.png" alt="Profile" class="profile-image-base me-2" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
          <div class="flex-grow-1">
            <div class="small fw-bold text-white" th:text="${usuario != null ? #strings.substringBefore(usuario.nombre, ' ') : 'Entrenador'}">Entrenador</div>
            <div class="small text-muted-flowfit">Entrenador</div>
          </div>
          <i class="bi bi-chevron-down text-white"></i>
        </div>
        <ul class="dropdown-menu" aria-labelledby="profileDropdownEntrenador">
          <li><a class="dropdown-item" th:href="@{/entrenador/perfil}"><i class="bi bi-person me-2"></i>Mi Perfil</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-2"></i>Cerrar SesiÃ³n</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content-base fade-in-up">
    <div class="container-fluid">
      <!-- Back Link -->
      <div class="mb-3">
        <a href="javascript:history.back()" style="color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 0.9375rem; transition: color 0.2s; display: inline-flex; align-items: center; gap: 0.5rem;">
          <i class="bi bi-arrow-left"></i>Volver
        </a>
      </div>

      <!-- Success/Error Messages -->
      <div th:if="${param.exito}" class="alert alert-success alert-dismissible fade show mb-4" role="alert" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #4ade80; border-radius: 12px;">
        <i class="bi bi-check-circle me-2"></i>
        Perfil actualizado correctamente.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="filter: brightness(0) invert(1);"></button>
      </div>
      
      <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #f87171; border-radius: 12px;">
        <i class="bi bi-exclamation-triangle me-2"></i>
        Error al actualizar el perfil. IntÃ©ntalo de nuevo.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="filter: brightness(0) invert(1);"></button>
      </div>

      <!-- Page Header -->
      <div class="welcome-header-enhanced mb-4">
        <div class="row align-items-center">
          <div class="col-lg-8">
            <h1 class="display-6 mb-2 text-white fw-bold">
              <i class="bi bi-person-circle me-2"></i>Mi Perfil ðŸ‘¤
            </h1>
            <p class="lead text-white-50">Actualiza tu informaciÃ³n personal</p>
          </div>
        </div>
      </div>

      <!-- Profile Form Card -->
      <div class="card-base card-entrenador">
        <div class="card-body">
          <form th:action="@{/editar-perfil}" method="POST">
            <div class="row g-4">
              <!-- Profile Image Section -->
              <div class="col-lg-4">
                <div style="background: rgba(59, 130, 246, 0.1); padding: 2rem; border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.3); text-align: center;">
                  <div style="width: 120px; height: 120px; border-radius: 50%; background: rgba(59, 130, 246, 0.2); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; overflow: hidden; border: 3px solid rgba(59, 130, 246, 0.5);">
                    <img src="/assets/perfil_default.png" alt="Foto de perfil" style="width: 100%; height: 100%; object-fit: cover;">
                  </div>
                  <h5 class="text-white mb-2" style="font-weight: 600;" th:text="${usuario.nombre}">Usuario</h5>
                  <span class="badge mb-3" style="background: rgba(59, 130, 246, 0.15); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); padding: 0.375rem 0.75rem; border-radius: 50px; font-size: 0.875rem;" th:text="${usuario.perfilUsuario}">Entrenador</span>
                  <div class="mt-4 pt-4" style="border-top: 1px solid rgba(59, 130, 246, 0.3);">
                    <small style="color: rgba(255, 255, 255, 0.7); display: block; margin-bottom: 0.75rem;">JPG o PNG menor a 5MB</small>
                    <button class="btn" type="button" disabled style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.875rem; cursor: not-allowed;">
                      <i class="bi bi-camera me-1"></i>Cambiar foto
                    </button>
                  </div>
                </div>
              </div>

              <!-- Form Fields -->
              <div class="col-lg-8">
                <div class="row g-4">
                  <div class="col-12">
                    <label for="nombre" class="form-label" style="color: #e2e8f0; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9375rem;">
                      <i class="bi bi-person me-2" style="color: #60a5fa;"></i>Nombre completo
                    </label>
                    <input type="text" class="form-control form-control-entrenador" id="nombre" name="nombre" 
                           th:value="${usuario.nombre}" required 
                           placeholder="Ingresa tu nombre completo"
                           style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(59, 130, 246, 0.3); color: #e2e8f0; padding: 0.75rem 1rem; border-radius: 12px; font-size: 0.9375rem;">
                  </div>
                  
                  <div class="col-md-6">
                    <label for="numero_documento" class="form-label" style="color: #e2e8f0; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9375rem;">
                      <i class="bi bi-card-text me-2" style="color: #4ade80;"></i>NÃºmero de documento
                    </label>
                    <input type="text" class="form-control form-control-entrenador" id="numero_documento" name="numero_documento" 
                           th:value="${usuario.numeroDocumento}" required 
                           placeholder="NÃºmero de identificaciÃ³n"
                           style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(59, 130, 246, 0.3); color: #e2e8f0; padding: 0.75rem 1rem; border-radius: 12px; font-size: 0.9375rem;">
                  </div>
                  
                  <div class="col-md-6">
                    <label for="telefono" class="form-label" style="color: #e2e8f0; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9375rem;">
                      <i class="bi bi-telephone me-2" style="color: #fbbf24;"></i>TelÃ©fono
                    </label>
                    <input type="tel" class="form-control form-control-entrenador" id="telefono" name="telefono" 
                           th:value="${usuario.telefono}" required 
                           placeholder="NÃºmero de telÃ©fono"
                           style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(59, 130, 246, 0.3); color: #e2e8f0; padding: 0.75rem 1rem; border-radius: 12px; font-size: 0.9375rem;">
                  </div>
                  
                  <div class="col-12">
                    <label for="correo" class="form-label" style="color: #e2e8f0; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9375rem;">
                      <i class="bi bi-envelope me-2" style="color: #a78bfa;"></i>Correo electrÃ³nico
                    </label>
                    <input type="email" class="form-control form-control-entrenador" id="correo" name="correo" 
                           th:value="${usuario.correo}" required 
                           placeholder="correo@ejemplo.com"
                           style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(59, 130, 246, 0.3); color: #e2e8f0; padding: 0.75rem 1rem; border-radius: 12px; font-size: 0.9375rem;">
                  </div>

                  <!-- Action Buttons -->
                  <div class="col-12 pt-3">
                    <div class="d-flex gap-3">
                      <button type="submit" class="btn-flowfit-primary btn-entrenador-primary btn-enhanced">
                        <i class="bi bi-check-lg me-2"></i>Guardar cambios
                      </button>
                      <a href="javascript:history.back()" class="btn-flowfit-outline btn-entrenador-outline btn-enhanced">
                        <i class="bi bi-x-lg me-2"></i>Cancelar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Footer -->
      <footer class="footer-base mt-5">
        Â© 2025 FlowFit - Panel de Entrenador. Todos los derechos reservados.
      </footer>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- FlowFit Perfil Script -->
  <script>
    // Mobile Sidebar Toggle
    document.addEventListener('DOMContentLoaded', function() {
      const sidebarToggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      const sidebarCollapseBtn = document.getElementById('sidebarCollapseBtn');
      const mainContent = document.querySelector('.main-content-base');

      // Mobile toggle
      function toggleSidebar() {
        sidebar.classList.toggle('show');
        sidebarOverlay.classList.toggle('show');
      }

      function closeSidebar() {
        sidebar.classList.remove('show');
        sidebarOverlay.classList.remove('show');
      }

      sidebarToggle?.addEventListener('click', toggleSidebar);
      sidebarOverlay?.addEventListener('click', closeSidebar);

      // Desktop collapse toggle
      sidebarCollapseBtn?.addEventListener('click', function() {
        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('sidebar-collapsed');
        
        const icon = this.querySelector('i');
        if (sidebar.classList.contains('collapsed')) {
          icon.classList.remove('bi-chevron-left');
          icon.classList.add('bi-chevron-right');
          this.classList.add('collapsed');
        } else {
          icon.classList.remove('bi-chevron-right');
          icon.classList.add('bi-chevron-left');
          this.classList.remove('collapsed');
        }
      });

      // Close sidebar on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeSidebar();
      });

      console.log('FlowFit Perfil page loaded successfully! ðŸ”¥');
    });
  </script>

  <style>
    /* Focus styles for inputs */
    .form-control:focus,
    .form-control-entrenador:focus {
      background: rgba(59, 130, 246, 0.1) !important;
      border-color: #3b82f6 !important;
      box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.15) !important;
      color: #ffffff !important;
      outline: none;
    }
    
    .form-control::placeholder,
    .form-control-entrenador::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }
  </style>
</body>
</html>